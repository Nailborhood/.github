
<h1>💅 내동네일 💅 </h1>
</br>

<h3> 내 주변 동네 네일샵 정보를 소개하고, 고객들의 리뷰를 모아서 볼 수 있는 사이트  </h3>


<!-- <div >
  네일
  </br>
  온라인과 오프라인 커뮤니티를 통해</br>
  혼자서가 아닌 많은 사람들과 함께 환경보호를 즐기고 싶다면!</br>

</div> -->

</br>
</br>

</br>

## 🚩 프로젝트 개요
* **프로젝트 명** : **내동네일**
* **진행 기간** : 24.02 ~ 24.04

</br>

## 👨‍👩‍👧‍👦 팀원 소개

| 김연수 | 엄수현 | 정경은 | 정준용 |
| :---: | :---: | :---: | :---: |
| <img alt="김연수" src="https://github.com/Nailborhood/mvc/assets/107487996/c538a425-f620-4426-8e51-1641b2e6278e" height="100" width="100"> | <img alt="엄수현" src="https://cdn.discordapp.com/attachments/1202063471303200858/1235862291745079346/image.png?ex=6635e9f3&is=66349873&hm=199257e91c75c5a7359129bf8d2d0826b44239bf34d487b8d82b2dfda46ad40f&" height="100" width="100"> | <img alt="정경은" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/7c56b595-b282-4334-99c5-cfd48813355c" height="100" width="100"> | <img alt="정준용" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/ab5e2a03-d440-4e5b-8d1a-b929742ae69a" height="100" width="100"> |
| [@younssue](https://github.com/younssue) | [@eumssooo](https://github.com/eumssooo) | [@bbororo](https://github.com/bbororo) | [@wnsdyd1012](https://github.com/wnsdyd1012) |

</br>

## ⚙️기술 스택
### Tools
| Git | Github | Discord | Notion |
| :---: | :---: | :---: | :---: |
| <img alt="git logo" src="https://git-scm.com/images/logos/logomark-orange@2x.png" width="65" height="65" > | <img alt="github logo" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="65" height="65"> | <img alt="Discord logo" src="https://assets-global.website-files.com/6257adef93867e50d84d30e2/62595384e89d1d54d704ece7_3437c10597c1526c3dbd98c737c2bcae.svg" height="65" width="65"> | <div style="display: flex; align-items: flex-start;"><img src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/15b94d68-61bd-48d5-8931-2180b62fb9a6" alt="icon" width="65" height="65" /></div>
### Front-end
| Html | CSS | TypeScript |
| :---: | :---: | :---: |
| <img alt="Html" src ="https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/HTML5_logo_and_wordmark.svg/440px-HTML5_logo_and_wordmark.svg.png" width="65" height="65" /> | <img alt="css" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/cc90533f-6811-4e1b-84e9-6314c9d01da0" height="70" width="70" > | <div style="display: flex; align-items: flex-start;"><img src="https://github.com/Nailborhood/mvc/assets/107487996/53c90d94-0d42-4329-bfb8-168374bb45d1" alt="js" width="75" height="75" /></div> |
### Back-end
| Java | mySQL | Security | Spring<br>data Jpa | Spring<br>Boot | Thymeleaf | Gradle | SocketIO | 
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| <div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/java-icon.svg" alt="icon" width="65" height="65" /></div> | <div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/mysql-icon.svg" alt="icon" width="65" height="65" /></div> | <div style="display: flex; align-items: flex-start;"><img src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/684edab9-ea95-4c8e-9542-ba9a81a45aa4" alt="icon" width="65" height="65" /></div> | <img alt="jpa" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/61c62ddf-7d88-4314-8a42-40bc7ae1d267" width="70" height="80" > | <img alt="spring-boot logo" src="https://t1.daumcdn.net/cfile/tistory/27034D4F58E660F616" width="65" height="65" > | <img alt="thymeleaf" src="https://github.com/Nailborhood/mvc/assets/107487996/7a591a69-968e-4412-bc58-41d7ffd0037e" height="70" width="70" > | <img alt="Gradle" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/204f14a3-8484-4cdc-9393-b2e7372d12cd" width="80" height="80" > | <img alt="websocket" src="https://cdn.discordapp.com/attachments/1202063471303200858/1235865816709464084/68747470733a2f2f692e696d6775722e636f6d2f70666e4f6454442e706e67.png?ex=6635ed3b&is=66349bbb&hm=1ae9d16112e68960919dbec76d5db1f4e1bce9b0747705dc3bfdb6db0e273ca4&" width="80" height="80" > |

### Deploy
| Docker | RDS | S3 | AWS | EC2 | NginX |
| :---: | :---: | :---: | :---: | :---: | :---: |
| <div style="display: flex; align-items: flex-start;"><img src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/eac13cef-d1d7-4b34-946e-d67ca5378821" alt="icon" width="65" height="65" /></div> | <div style="display: flex; align-items: flex-start;"><img src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/7f84e396-abf0-4c5f-b5a6-9764db8caaae" alt="icon" width="65" height="65" /></div> | <div style="display: flex; align-items: flex-start;"><img src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/8016cb6f-4bcc-4a4e-8083-11912fd121ae" alt="icon" width="65" height="65" /></div> | <div style="display: flex; align-items: flex-start;"><img src="https://techstack-generator.vercel.app/aws-icon.svg" alt="icon" width="65" height="65" /></div> | <img alt="spring logo" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/eeef6430-605e-471a-a957-2433dd796aca" height="50" width="50" > | <img alt="nginx" src="https://github.com/volunteer-community/volunteer-backend/assets/107487996/e602cabc-7e61-42ed-a296-11e8355b0654" width="80" height="80" > |

<br>


## 🗂️ 기능 설명
<details>
<summary>1. 회원 </summary>
<div dir="auto">

<br>
  
- 로그인
    - 자체로그인
        - 이메일, 비밀번호로 로그인
        - 스프링시큐리티를 통한 로그인 세션 관리
    - 구글로그인
        - 스프링시큐리티 OAuth2.0으로 로그인 및 회원가입
    - 권한(유저, 오너, 관리자)에 따라 접근가능한 페이지 분리
    - 로그인 완료 시 홈화면으로 이동
- 자체회원가입 (일반 유저)
    - 이메일, 비밀번호, 이름, 생년월일, 전화번호, 성별, 닉네임
    - 이메일, 전화번호, 닉네임 중복확인
    - 비밀번호 (8자~ 20자 제한)
    - 비밀번호확인 입력 일치 여부 확인
    - 프로필사진은 기본 사진 (마이페이지에서 수정 가능)
    - 가입일자, 권한(일반 유저), 회원탈퇴여부 → 자동 입력
- 구글 회원 가입
    - 구글에서 이메일, 이름, 프로필 사진 가져오기
    - 비밀번호는 UUID로 저장
    - 닉네임은 이름, 성별은 선택하지 않음으로 입력
    - 단, 소셜로그인 유저는 오너 권한 발급 불가
- 이메일 확인
- 비밀번호 확인
</div>
</details>


<details>
<summary> 2. 매장(내주변) </summary>
<div dir="auto">

<br>
  
- 매장 신청
    - 사업자 전환 신청 시 매장 등록 신청도 동시에 처리
    - 관리자 쪽에서 매장 등록 신청을 승인 시 일반 유저에서 사장님 권한인 유저로 Role 변경
    - 매장 등록 시 city(시) , districts(구) ,dong(동) 데이터 값에 맵핑에 저장
    - AWS S3를 이용하여 리뷰이미지 등록
    - S3에 업로드 된 이미지 객체 URL을 DB에 imgPath로 저장
- 매장 수정
    - 해당 매장을 소유한 owner만이 매장 수정할 수 있게 권한 설정
        - owner domain table에 조인되어 있는 shop 정보를 조회해 shopId 가져와서 shopId 해당 매장 정보 수정
    - 매장 사진, 매장 정보, 매장 주소를 변경
    - S3에 등록된 리뷰 이미지 삭제 후 수정된 이미지 업로드, S3에 업로드된 이미지 URL DB에 저장
- 매장 조회
    - city(시) , districts(구) ,dong(동), keyword (검색), sortby(정렬순) 으로 검색 조회 기능
- 매장 삭제
    - 관리자에게 채팅으로 삭제 요청 → 관리자가 해당 매장 삭제
- 매장 상세 조회
    - 매장 리뷰, 아트 조회
        - 해당 매장에 맞는 리뷰와 아트 조회
        - 카테고리, 정렬순, 검색어를 통해 검색 조회 가능
- 매장 찜
    - pathvaiable로 shopId에 해당하는 매장 찜
    - 매장 찜 눌렀을 시 해당 매장의 사업자에게 알림 발송
    - 첫 찜 → true생성 ( true : 찜, false : 찜 취소)
    - 다시 눌렀을 때 false로 반환, false일때 다시 누를시 true로 반환

</div>
</details>

<details>
<summary> 3. 리뷰 </summary>
<div dir="auto">

<br>
  
- 리뷰 등록
    - 네일받은 매장에서 리뷰 내용, 별점, 이미지, 카테고리 등록
    - 매장 평균 별점 수정
    - AWS S3를 이용하여 리뷰이미지 등록
    - S3에 업로드 된 이미지 객체 URL을 DB에 imgPath로 저장
    - 리뷰 등록 시 해당매장 사업자에게 알림 발송
- 리뷰 수정
    - pathvariable로 reviewID에 해당하는 리뷰의 상세페이지를 조회하여 리뷰 수정
    - 리뷰내용, 별점, 이미지, 카테고리 수정 가능
    - S3에 등록된 리뷰 이미지 삭제 후 수정된 이미지 업로드, S3에 업로드된 이미지 URL DB에 저장
- 리뷰 좋아요
    - pathvaiable로 reviewId에 해당하는 리뷰 좋아요
    - 첫 좋아요 → true생성 ( true : 좋아요, false : 좋아요 취소)
    - 다시 눌렀을 때 false로 반환, false일때 다시 누를시 true로 반환
    - 리뷰 좋아요 시에 해당 리뷰의 작성자에게 알림 발송
- 리뷰 신고
    - pathvariable로 reviewID에 해당하는 리뷰를 찾아 조회하여 리뷰 사유를 작성하여 리뷰 신고
- 리뷰 삭제 시
    - 좋아요 수 0으로 변경, reviewLike status false로 변경
    - 매장 리뷰수 0으로 변경
    - 카테고리, 리뷰 신고 컬럼 삭제
    - 해당 리뷰 false → true 변경 ( 소프트 딜리트 지향)
    - 관리자측에서 모든리뷰(삭제된 리뷰 포함) 조회가 가능하기 때문에 mainImg가 필요하여 리뷰 이미지는 false로 유지
- 리뷰 조회
    - 카테고리, 정렬순, 검색어를 통해 검색 조회 가능
</div>
</details>

<details>
<summary> 4. 아트 </summary>
<div dir="auto">

<br>
  
- 아트 등록
    - 사업자가 본인 매장에 아트이미지, 카테고리, 제목, 내용 등록
    - memberId에서 ownerId로 연결하여 ownerId에 해당하는 매장ID에 아트 등록
    - AWS S3를 이용하여 리뷰이미지 등록
    - S3에 업로드 된 이미지 객체 URL을 DB에 imgPath로 저장
- 아트 수정
    - pathvariable로 artId에 해당하는 아트를 찾아 아트 수정
    - S3에 등록된 리뷰 이미지 삭제 후 수정된 이미지 업로드, S3에 업로드된 이미지 URL DB에 저장
    - 제목과 내용, 카테고리, 이미지 수정가능
- 아트 좋아요
    - pathvaiable로 artId에 해당하는 아트 좋아요
    - 아트 좋아요 시 해당 매장의 사업자에게 알림 발송
    - 첫 좋아요 → true생성 ( true : 좋아요, false : 좋아요 취소)
    - 다시 눌렀을 때 false로 반환, false일때 다시 누를시 true로 반환
- 아트 삭제
    - pathvariable로 artId에 해당하는 아트를 찾아 아트 삭제
    - 해당 아트의 이미지 컬럼 false → true로 변경
    - 해당 아트 false → true로 변경(소프트 딜리트 지향)
- 아트 조회
    - 카테고리, 정렬순, 검색어(아트 제목, 매장이름)를 통해 검색 조회 가능
- 아트 북마크
    - pathvaiable로 artId에 해당하는 아트 북마크
    - 첫 북마크 → true생성 ( true : 북마크, false : 북마크 취소)
    - 다시 눌렀을 때 false로 반환, false일때 다시 누를시 true로 반환

</div>
</details>

<details>
<summary> 5. 마이페이지 </summary>
<div dir="auto">

<br>
  
- 유저 페이지
    - 로그인한 유저의 정보(저장한 매장, 내가 남긴 리뷰, 북마크)를 확인
    - 마이페이지의 메뉴로 이동
- 개인정보 수정
    - 이름, 전화번호, 성별, 생일 수정
- 프로필 설정
    - 다른 유저에게 노출되는 정보 수정
    - 프로필 사진, 닉네임 수정
- 로그아웃
- 사업자 전환 신청
    - 일반 회원 유저 → owner (사장님)으로 권한 신청할 수 있는 페이지로 이동
- 내가 작성한 리뷰
    - 로그인유저의 세션?토큰? 에서 memberId에 해당하는 review조회
    - 신고 당하거나, 매장영업이 중지되어서 나의 리뷰가 삭제될수있기때문에 내가 작성한 모든리뷰(삭제포함) 조회가능
- 찜한 매장 조회
    - 찜 테이블에서 로그인유저의 세션?토큰? 에서 memberId의 찜 상태가 true인 매장리스트 조회
- 북마크한 아트 조회
    - 북마크 테이블에서 로그인유저의 세션?토큰? 에서 memberId의 북마크 상태가 true인 아트 리스트 조회

</div>
</details>

<details>
<summary> 6. 사업자 페이지  </summary>
<div dir="auto">

<br>
  
- 내 매장
    - owerId에 join되어 있는 shopId로 내 매장 상세 조회
- 매장 정보 수정
    - owerId에 join되어 있는 shopId로 저장되어 있는 매장 정보 수정
- 매장 리뷰 관리
    - owerId에 join되어 있는 shopId로 해당하는 매장의 리뷰 리스트 조회
    - 리뷰 내용과 작성자로 검색가능
- 매장 아트 관리
    - owerId에 join되어 있는 shopId로 해당하는 매장의 아트 리스트 조회
    - 리스트에서 아트선택하여 수정, 삭제 가능
    - 아트 제목으로 검색 가능
- 아트 등록
- 1:1 문의
    - 채팅 기록이 없다면 채팅룸 생성 페이지
    - 채팅 기록이 있다면 채팅 상세페이지로 이동

</div>
</details>

<details>
<summary> 7. 관리자 페이지 </summary>
<div dir="auto">

<br>
  
- 매장 신청 조회
    - 사업자 전환 신청 시 매장 등록 신청
    - ShopStatus == ‘READY’ 로 매장 신청 조회
- 매장 신청 처리
    - 매장 신청 승인 시 매장 ShopStatus == ‘OPEN’ 으로 변경, 일반 유저 user → owner로 Role 변경
    - 매장 신청 반려 시 매장 삭제 처리
- 매장 목록 조회 , 회원 목록 조회, 리뷰 목록 조회
    - keyword 검색 기능
    - 전체 목록 조회
- 채팅룸 목록 조회
    - owner가 만든 채팅룸에 join된 adminId로 전체 채팅룸 목록 조회
- 리뷰 신고 조회
    - user, owenr가 리뷰 신고 시 reviewReport 테이블에 저장된
    
          ReviewReportStatus ==’REVIEW_REPORT_PENDING ’ 해당되는 목록 조회 
    
- 리뷰 신고 처리
    - 리뷰 신고 승인 시 ReviewReportStatus ==’REVIEW_REPORT_ACCEPTED ’ 로 변경,
        
        리뷰 전체 목록, 마이 페이지 내 리뷰 관리에서 삭제된 리뷰로 처리됨 
        
    - 리뷰 신고 반려 시 ReviewReportStatus ==’REVIEW_REPORT_REJECTED ’ 로 변경

</div>
</details>



<details>
<summary> 8. 채팅, 실시간 알림 </summary>
<div dir="auto">

<br>
  
1) 채팅
- Websocket, STOMP를 활용한 채팅
    - WebSocket: 실시간 양방향 통신 프로토콜
    - STOMP: WebSocket 위에서 동작하는 메시징 프로토콜, 클라이언트-서버 간 메시지 정의 가능
- STOMP 채팅 구현
    - 클라이언트: WebSocket으로 서버 연결, STOMP 메시지 송수신
    - 서버: STOMP 메시지 처리, 메시지 브로커로 구독자에게 전달
    - 실시간 채팅 기능 구현 가능
        - 서버 구현: STOMP 엔드포인트 설정, 메시지 브로커 설정, 메시지 핸들러 구현
        - 클라이언트 구현: WebSocket 연결, STOMP 클라이언트 생성, 메시지 송수신 구현
        - 채팅방 구현: 채팅방 생성, 사용자 입장, 메시지 전송 등의 기능 구현
        - 채팅 시 상대방에게 실시간 알림 기능 구현

2) 실시간 알림
- WebSocket을 활용한 실시간 알림
- WebSocket 연결
    - 클라이언트가 WebSocket 연결을 할때 사용자 정보(이메일을) 저장
    - 연결이 끊어질 때 사용자 정보 제거
- 알림 메시지 처리
    - 클라이언트가 보낸 메시지를 파싱하여 알림정보 (알림 유형(alarmType), 수신자(receiver), 알림을보내는 링크 url, alarmId)추출
    - 수신자(receiver)의 Websocket 세션을 찾아 해당 세션으로 알림 메시지를 전송
    - 알림 메시는 JSON 형식으로 구성 

   
</div>
</details>



<details>
<summary> 9. 배포 </summary>
<div dir="auto">

<br>
  
- 배포 전략 (Blue/Green)
- AWS EC2
    - RDS (mysql)
    - 탄력적 ip 사용
    - 도메인 연결
    - https
        - SSL
- Docker
    - Dockerfile (빌드된 Project jar을 이미지로 구워 Docker Hub에 Upload)
    - Docker Commpose (Blue와 Green Container를 따로 관리)
- Nginx (무중단 배포)
- Github Actions (CI/CD를 위해 사용)
    - GitHub Push or Pull Request 후 빌드 실행
    - Dockerfile 실행
    - EC2 접속 → Docker hub → Project image pull
    - [deploy.sh](http://deploy.sh/) 실행 → 현재 blue container 실행 중 이면 → green 실행 or 현재 green container 실행 중 이면 → blue container 실행
    - health check 후 정상적으로 동작
    - 배포 완료
</div>
</details>

<br>

## 📑 관련 문서

### 📌 ERD
  ![ERD  GrowStory_final](https://github.com/Nailborhood/mvc/assets/107487996/5b35cc33-c85b-4216-832c-99151579bf09)



